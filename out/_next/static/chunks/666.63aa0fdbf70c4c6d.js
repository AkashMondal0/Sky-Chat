"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{40666:function(e,t,s){s.r(t);var a=s(9268),n=s(56970),r=s(92621),i=s(5109),o=s(16160),l=s(86006),d=s(81667),c=s(19260),u=s(9516),g=s(16147);t.default=e=>{let{UserId:t,item:s}=e,m=(0,r.Z)(),[v,f]=(0,l.useState)(i.R),p=async()=>{let e=await (0,o.Lv)(t);f(e)};(0,l.useEffect)(()=>{p()},[]);let h=(0,l.useCallback)(async(e,t)=>{(0,d.j)(t,m.state.id,e),(0,u.HA)(m.state,v)},[m.state,v]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"sm:cursor-pointer flex justify-between items-center py-3 px-2 rounded-xl hover:bg-gray-100",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(n.u1,{children:(0,a.jsx)("img",{className:"w-14 h-14 rounded-full object-cover border-[1px]",alt:"not found",src:(null==v?void 0:v.image)||"/user.png"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(n.ZT,{variant:"h6",color:"blue-gray",children:(null==v?void 0:v.name)||"No Name"}),(0,a.jsx)(n.ZT,{variant:"small",color:"gray",className:"font-normal",children:(0,g.$)((null==v?void 0:v.email)||"")||"No Email"})]})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(c.Z,{danger:!0,onClick:()=>{(0,d.j)(s.id,m.state.id,v.id)},label:"Cancel"}),(0,a.jsx)(c.Z,{onClick:()=>{h(v.id,s.id)},label:"Confirm"})]})]})})})}},16147:function(e,t,s){s.d(t,{$:function(){return a}});function a(e){return e.length>5?e.substring(0,25)+"...":e}},9516:function(e,t,s){s.d(t,{DO:function(){return c},HA:function(){return l},Qz:function(){return d},hO:function(){return u}});var a=s(6936),n=s(33134),r=s(9802),i=s(22082),o=s(16160);let l=async(e,t)=>{let s=new Date().toISOString(),o=(0,r.ZP)(),l={id:(0,r.ZP)(),createDate:s,updateDate:s,lastMessageDate:s,lastMessage:"new conversation",type:"PERSONAL",MessageDataId:o,friendData:{id:t.id,name:t.name,email:t.email},isGroup:!1,group:{admin:[],groupName:null,groupImage:null,groupMembers:[],CreatedUser:""}},d={...l,friendData:{id:e.id,name:e.name,email:e.email}};try{return(0,a.r7)((0,a.JU)(n.db,"users",e.id),{Conversations:(0,a.vr)(l)}),(0,a.r7)((0,a.JU)(n.db,"users",t.id),{Conversations:(0,a.vr)(d)}).then(()=>{(0,i.D)(o)}),!0}catch(e){return console.log(e),{message:e,code:400}}},d=async e=>{let t=new Date().toString(),{lastMessage:s,UserId:r,friendId:i,conversationId:l}=e;try{let e=await (0,o.Lv)(r),d=await (0,o.Lv)(i),c=e.Conversations.map(e=>e.id===l?{...e,lastMessage:s,lastMessageDate:t}:e),u=d.Conversations.map(e=>e.id===l?{...e,lastMessage:s,lastMessageDate:t}:e);await (0,a.pl)((0,a.JU)(n.db,"users",r),{...e,Conversations:c}),await (0,a.pl)((0,a.JU)(n.db,"users",i),{...d,Conversations:u})}catch(e){console.log("Error getting document:",e)}},c=async e=>{let t=new Date().toString(),s=(0,r.ZP)(),o={id:(0,r.ZP)(),createDate:t,updateDate:t,lastMessageDate:t,lastMessage:"add you",isGroup:!0,group:e,type:"GROUP",MessageDataId:s,friendData:{id:"",name:"",email:""}};try{for(let t=0;t<e.groupMembers.length;t++){let s=e.groupMembers[t];await (0,a.r7)((0,a.JU)(n.db,"users",s.userId),{Conversations:(0,a.vr)(o)})}return await (0,i.D)(s),!0}catch(e){console.log(e)}},u=async(e,t)=>{var s;let r=new Date().toString(),{lastMessage:i,UserId:l,friendId:d,conversationId:c}=e,u=(null===(s=t.group)||void 0===s?void 0:s.groupMembers)||[];if(u.length<0)throw Error("user not found");for(let e=0;e<(null==u?void 0:u.length);e++){let t=await (0,o.Lv)(u[e].userId);Promise.all(t.Conversations.map(e=>e.id===c?{...e,lastMessage:i,lastMessageDate:r}:e)).then(s=>{(0,a.pl)((0,a.JU)(n.db,"users",u[e].userId),{...t,Conversations:s})})}}},22082:function(e,t,s){s.d(t,{D:function(){return o},P:function(){return i}});var a=s(6936),n=s(33134),r=s(6823);let i=async(e,t)=>{var s=[];try{if(e.img.length>0)for(let t=0;t<e.img.length;t++){let a=await (0,r.z)(e.img[t],e.messageUserId);s.push(a)}await (0,a.r7)((0,a.JU)(n.db,"UserMessage",t),{senderMessages:[],receiverMessages:[],messages:(0,a.vr)({id:e.id,message:e.message,img:s,reply:e.reply,seenIds:e.seenIds,createdAt:new Date().toISOString(),updateAt:new Date().toISOString(),date:new Date().toISOString(),conversationId:e.conversationId,messageUserId:e.messageUserId})})}catch(e){console.log(e)}},o=async e=>await (0,a.pl)((0,a.JU)(n.db,"UserMessage",e),{id:e,messages:[],senderMessages:[],receiverMessages:[]}).then(()=>e).catch(e=>{console.log(e)})},6823:function(e,t,s){s.d(t,{z:function(){return r}});var a=s(64202),n=s(33134);let r=async(e,t)=>{let s=new Promise((s,r)=>{let i=(0,a.iH)(n.tO,"UserFiles/".concat(t,"/").concat(e.name)),o=(0,a.B0)(i,e);o.on("state_changed",e=>{e.bytesTransferred,e.totalBytes},e=>{console.log(e)},()=>{(0,a.Jt)(o.snapshot.ref).then(e=>{s(e)})})});return s}}}]);